version: '3.8'

services:
  rf-tests:
    build: .
    container_name: mej-rf-tests
    environment:
      # Pass environment variables from .env file or host
      - MEJ_URL=${MEJ_URL}
      - MEJ_API_URL=${MEJ_API_URL}
      - MEJ_HEADLESS=${MEJ_HEADLESS}
      - MEJ_TIMEOUT=${MEJ_TIMEOUT}
      - MEJ_ADMIN_EMAIL=${MEJ_ADMIN_EMAIL}
      - MEJ_ADMIN_PASSWORD=${MEJ_ADMIN_PASSWORD}
      - MEJ_DRIVER_EMAIL=${MEJ_DRIVER_EMAIL}
      - MEJ_DRIVER_PASSWORD=${MEJ_DRIVER_PASSWORD}
      - MEJ_COMPANY_EMAIL=${MEJ_COMPANY_EMAIL}
      - MEJ_COMPANY_PASSWORD=${MEJ_COMPANY_PASSWORD}
      - MEJ_DB_HOST=${MEJ_DB_HOST}
      - MEJ_DB_PORT=${MEJ_DB_PORT}
      - MEJ_DB_NAME=${MEJ_DB_NAME}
      - MEJ_DB_USER=${MEJ_DB_USER}
      - MEJ_DB_PASSWORD=${MEJ_DB_PASSWORD}
      - MEJ_LOG_TO_CONSOLE=${MEJ_LOG_TO_CONSOLE}
      - MEJ_WHATSAPP_PHONE=${MEJ_WHATSAPP_PHONE}
      - MEJ_WHATSAPP_DIAL_CODE=${MEJ_WHATSAPP_DIAL_CODE}
    volumes:
      # Mount results folder to access test reports
      - ./results:/app/results
    # Run in headless mode for CI/CD
    command: robot --outputdir results --exclude wip tests/
